name: Backport Merged Pull Request

on:
  pull_request:
    types:
      - closed
      - labeled

jobs:
  backport:
    name: Backport pull request
    runs-on: ubuntu-latest
    if: >
      github.event.pull_request.merged
      && (
        github.event.action == 'closed'
        || (
          github.event.action == 'labeled'
          && contains(github.event.label.name, 'backport')
        )
      )
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Setup Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.22
    - name: Run custom Go script
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GITHUB_EVENT: ${{ toJson(github.event) }} # Pass the github.event object as a JSON string
      run: |
        cd $GITHUB_WORKSPACE  # Move to the root of the repository
        cd .github/scripts/custom-backport
        go mod download
        go run main.go  # Run your Go script
